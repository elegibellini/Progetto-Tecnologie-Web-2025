{% extends 'accounts/main.html' %}
{% load static %}

{% block content %}
<style>
    body {
        background-color: #f8f5f0;
    }
</style>

<div style="text-align: center; padding: 20px;">
    <h2>Benvenuto all'Osteria di Citerna</h2>
    <br>

    {% if user.is_authenticated %}
        <a href="{% url 'prenota_tavolo' %}" class="btn btn-outline-dark mt-2 mb-4" style="font-weight: bold;">ðŸ“… Prenota un tavolo</a>
    {% endif %}

    <div class="container" style="text-align: left;">
        <form method="get" id="filtraggio-piatti" class="form-inline mb-4">
            <label for="portata" class="mr-2">Filtra per portata:</label>
            <select id="portata" name="portata" class="form-control mr-4">
                <option value="Tutti">Tutti</option>
                {% for cat in portate %}
                    <option value="{{ cat.nome }}" {% if cat.nome == portata %}selected{% endif %}>{{ cat.nome }}</option>
                {% endfor %}
            </select>
        
            <label for="ordine">Ordina per:</label>
            <select id="ordine" name="ordine" class="form-control mr-4">
                <option value="prezzo_asc" {% if ordine == 'prezzo_asc' %}selected{% endif %}>Prezzo crescente</option>
                <option value="nome" {% if ordine == 'nome' %}selected{% endif %}>Nome</option>
            </select>
                
            <button type="submit" class="orderpiattobutton">Applica</button>
        </form>
        
    </div>

    <div class="row">
        {% for cat_nome, piatti_cat in piatti_per_categoria.items %}
            <div class="container mt-4">
                <h2 style="color: #6a2e35;">{{ cat_nome }}</h2>
                <div class="row">
                    {% for piatto in piatti_cat %}
                        <div class="col-md-4">
                            <div class="card rounded shadow-sm" style="margin: 10px;">
                                {% if piatto.immagine %}
                                    <img src="{{ piatto.immagine.url }}" class="card-img-top" style="object-fit: cover; height: 220px;">
                                {% endif %}
                                <div class="card-body">
                                    <h5 class="card-title">{{ piatto.nome }}</h5>
                                    <p class="card-text" style="color: #7c9425; font-weight: bold;">{{ piatto.prezzo|floatformat:2 }} â‚¬</p>
                                    {% if piatto.ingredienti %}
                                        <p class="card-text">{{ piatto.ingredienti }}</p>
                                    {% endif %}
                                    {% if user.is_authenticated %}
                                        <form method="POST" action="{% url 'aggiungi_al_carrello' piatto.id %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="piatto_id" value="{{ piatto.id }}">
                                            <button type="submit" class="orderpiattobutton">Aggiungi all'ordinazione</button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>

    <br>

    {% if user.is_authenticated and suggeriti %}
    <div class="container mt-5">
        <h3 style="color:#5a2a3e;">Suggeriti per te:</h3>
        <div class="row">
            {% for piatto in suggeriti %}
            <div class="col-md-3">
                <div class="card rounded shadow-sm" style="margin:10px; max-width:200px;">
                    {% if piatto.immagine %}
                        <img src="{{ piatto.immagine.url }}" class="card-img-top" style="object-fit:cover; height:150px;">
                    {% endif %}
                    <div class="card-body text-center">
                        <h5 class="card-title">{{ piatto.nome }}</h5>
                        <p class="card-text" style="color:#7c9425; font-weight:bold;">{{ piatto.prezzo|floatformat:2 }} â‚¬</p>
                        <form method="POST" action="{% url 'aggiungi_al_carrello' piatto.id %}">
                            {% csrf_token %}
                            <button type="submit" class="orderpiattobutton">Aggiungi</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if preferiti %}
    <div class="container mt-5">
        <h3 style="color:#5a2a3e;">I preferiti in assoluto:</h3>
        <div class="row">
            {% for piatto in preferiti %}
            <div class="col-md-3">
                <div class="card rounded shadow-sm" style="margin:10px; max-width:200px;">
                    {% if piatto.immagine %}
                        <img src="{{ piatto.immagine.url }}" class="card-img-top" style="object-fit:cover; height:150px;">
                    {% endif %}
                    <div class="card-body text-center">
                        <h5 class="card-title">{{ piatto.nome }}</h5>
                        <p class="card-text" style="color:#7c9425; font-weight:bold;">{{ piatto.prezzo|floatformat:2 }} â‚¬</p>
                        <form method="POST" action="{% url 'aggiungi_al_carrello' piatto.id %}">
                            {% csrf_token %}
                            <button type="submit" class="orderpiattobutton">Aggiungi</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}


    <br><br>

    {% if user.is_authenticated %}
        <div>
            <a href="/logout/" class="loginbutton">LOGOUT</a>
        </div>
    {% else %}
        <div>
            <h3>Non perderti i nostri fuori menÃ¹ settimanali...</h3>
            <a href="/registrati/" class="loginbutton">REGISTRATI</a>
            <a href="/login/" class="loginbutton">LOGIN</a>
        </div>
    {% endif %}
</div>

<br><br>
{% endblock %}
